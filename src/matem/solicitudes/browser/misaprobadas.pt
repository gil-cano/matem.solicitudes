<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="matem.solicitudes">

<head>
  <metal:block fill-slot="top_slot">
    <tal:insert tal:replace="nothing" tal:define="dummy python:request.set('enable_border', 0)" />
  </metal:block>
  <metal:css fill-slot="style_slot"
             tal:define="resources_url string:${context/portal_url}/++resource++wcfc">
    <link href="++resource++wcfc/bootstrap/bootstrap-fixed.css"
          tal:attributes="href string:${resources_url}/bootstrap/bootstrap-fixed.css"
          rel="stylesheet" type="text/css"/>
    <!-- Bootstrap Image Gallery styles -->
    <link rel="stylesheet"
          href="http://blueimp.github.com/Bootstrap-Image-Gallery/css/bootstrap-image-gallery.min.css"
          tal:attributes="href string:${resources_url}/jquery-file-upload/css/bootstrap-image-gallery.min.css" />
    <style type="text/css">
      div.position-3\3a 4 {margin-left:-16%;} /* .position-3:4 */
      #contentActionMenus{
          visibility: hidden;
      }
    </style>
  </metal:css>
</head>

  <body>
    <metal:fill fill-slot="main">
      <!-- 
        header_macro view_macros/header | header_macro | base_macros/header;
        footer_macro view_macros/footer | footer_macro | base_macros/footer;
       -->
      <metal:main_macro define-macro="main"
            tal:define="portal_type python:here.getPortalTypeName().lower().replace(' ', '_');
            base_macros here/base/macros;
            view_template python:'%s_view' % portal_type;
            view_macros python:path('here/%s/macros|nothing' % view_template);
            
            body_macro view_macros/body | body_macro | base_macros/body;
            folderlisting_macro view_macros/folderlisting | folderlisting | base_macros/folderlisting;
            
            errors python:request.get('errors', {})">

    <metal:header_macro define-macro="header">
        <span tal:define="usuarioActual user/getId">
            <dl class="portalMessage warning"
                tal:condition="python:view.hasPendingReviews(usuarioActual)">
                <dt i18n:translate="label_atencion">
                    Attention!
                </dt>
                <dd i18n:translate="label_pending_reviews">
                     You have pending reviews! Review your pending requests using the square in the right called 'Review List'.
                </dd>
            </dl>
        </span>
        <p style="color: #FF0000;" tal:content="python:'Estado del Periodo '+str(here.Title())+': '+str(here.getWFStateName())"></p>
        <h1 class="documentFirstHeading" i18n:translate="label_approved_app">My approved applications</h1>
        <table><tr>
        <td><img src="" tal:attributes="src string:${context/absolute_url}/++resource++ma.png" width="48" height="48"></td>
        <th><div i18n:translate="help_approved_app">Here you can see your approved applications</div> dentro del folder <span tal:replace="here/title_or_id">content title or id</span></th>
        </tr></table>
        <div class="tabularView" tal:condition="python: str(here.getWFState()) != 'historico'">
          <table class="listing" align="right" border="0">
            <tr>
                 <td><a href="" tal:attributes="href string:${context/absolute_url}/folder_factories">
                             <img src="" width="20" height="20" tal:attributes="src string:${context/absolute_url}/++resource++nueva.png"/>
                      </a>
                      <a href="" tal:attributes="href string:${context/absolute_url}/folder_factories">Nueva Solicitud</a>
                 </td>

            </tr>
          </table>
        </div>

        </metal:header_macro>

    <metal:body_macro define-macro="body">

    <br>
    <!-- Obtiene usuario actual -->
    <span tal:define="usuarioActual user/getId">

    <span tal:define="items python:view.getSolicitudesAprobadasIndividuales(usuarioActual)">


    <!--Cantidad -->
    <br><br>
    <h3 i18n:translate="label_approved_quantities_sol">Total Approved Quantities</h3>

	<div class="tabularView">
                <table class="listing" border="1" width="100%">
                    <tbody>        
                            <tr>
                                <th class="column" i18n:translate="label_solicitor">
                                   Solicitante
                                </th>
                                <th class="column" i18n:translate="label_total_approved_quantity">
                                   Sum of All Approved Quantities
                                </th>
                                <th class="column" i18n:translate="label_total_approved_license_days">
                                   Dias de License Aprobados
                                </th>
                                <th class="column" i18n:translate="label_total_approved_commission_days">
                                   Dias de Comision Aprobados
                                </th>
                             </tr>
                           <tr tal:repeat="investigador python:view.getPresupuestoIndividual(usuarioActual)">
                                <td tal:content="python:investigador[0]">Solicitor</td>
                                <span tal:condition="items">
                                    <span tal:define="itemtotal python:view.calcularTotal(items)">
                                        <td align="center" tal:content="itemtotal">Approved Quantity</td>
                                        <td align="center" tal:content="python:investigador[2]">License Days</td>
                                        <td align="center" tal:content="python:investigador[3]">Commission Days</td>
                                        <span tal:condition="python:view.compararValores(investigador[1],itemtotal)"></span>
                                    </span>
                                </span>
                                <span tal:condition="not:items">
                                        <td align="center">0.0</td>
                                        <td align="center">0.0</td>
                                        <td align="center">0.0</td>
                                        <span tal:condition="python:view.compararValores(investigador[1],0.0)"></span>
                                </span>
<!--                                <td align="center" tal:content="python:investigador[1]">Approved Quantity</td>-->
                          </tr>

                           <tr tal:repeat="totales python:view.getCantidadAsignadaLocal(usuarioActual)">
                                <th align="right" i18n:translate="" tal:content="python:totales[0]">Indicator</th>
                                <td colspan="3" tal:content="python:totales[1]">Quantity</td>
                          </tr>
                    </tbody>
                 </table>
	</div>

    <h3 tal:condition="not:items" i18n:translate="label_no_approved">None of your applications has been approved yet.</h3>
    <h4 tal:condition="not:items" i18n:translate="label_no_show">There are no applications to show.</h4>

<span name="tablaSolicitudes">
<br><br>

    <h3 tal:condition="items" i18n:translate="label_approved_quantities_nosol">Approved Quantities per Request</h3>
    <!-- <a tal:condition="items" href="javascript: printTable('tablaSolicitudes')">Imprimir</a> -->
    <div class="fc">
    <table class="table table-bordered table-condensed table-hover" tal:condition="items">
        
 	<thead>
		<th i18n:translate="label_type">Type</th>
		<th i18n:translate="label_solicitor">Solicitante</th>
		<th i18n:translate="label_reason">Reason</th>
		<th i18n:translate="label_place">Place</th>
		<th i18n:translate="label_creation_date">Solicitud Creada</th>
		<th i18n:translate="label_start_date">Fecha de Inicio</th>
		<th i18n:translate="label_end_date">Fecha de Termino</th>
		<th i18n:translate="label_quantity_days">Cantidad de DÃ­as</th>
		<th i18n:translate="label_approved_quantity">Approved Quantity (pesos)</th>
		<th i18n:translate="label_fecha_revision">Fecha de Revision por Consejo Interno</th>
		<th>con cargo a:</th>
		<th i18n:translate="label_state">State</th>
	</thead>
  <tbody>
        <tr tal:repeat="item python:items">
          <td><a href="#" tal:attributes="href python:item['url']"
          tal:content="python:item['special_fields']['readable_meta_type']">Meta-Type</a></td>
          <td tal:content="python:item['owner_name']">Solicitant</td>
          <td tal:content="python:item['objective']">Reason</td>
          <td tal:content="python:item['country']">Place</td>
	  <td tal:content="python:item['creation_date']">Solicitud Creada</td>
          <td tal:content="python:item['from']">Creation Date</td>
          <td tal:content="python:item['to']">Creation Date</td>
          <td align="center" tal:content="python:item['quantity_of_days']">Quantity of Days</td>
          <td align="center" tal:content="python:item['total_approved_quantity']">Quantity</td>
          <td align="center" tal:content="python:item['revision_ci_date']">Fecha de Revision</td>
          <td tal:content="python:item['cargo_presupuesto']">Con cargo</td>
          <td tal:content="python:item['workflow_state_name']">workflow state</td>
        </tr>

        </tbody>
    </table>
    </div>
</span>

    </span>
    </span>
    </metal:body_macro>
    <metal:footer_macro define-macro="footer">

    </metal:footer_macro>
    <metal:folderlisting_macro define-macro="folderlisting">

    </metal:folderlisting_macro>

      </metal:main_macro>
    </metal:fill>
  </body>
</html>
